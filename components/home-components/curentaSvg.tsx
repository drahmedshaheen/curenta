'use client';
import { motion, useMotionValueEvent, useScroll } from 'framer-motion';
import { observer, useObservable } from '@legendapp/state/react';
import {
  calculatePercentage,
  percentageToValue,
  generateAnimationValues,
} from 'scripts/math';

interface CurentaSvgProps {
  ref: any;
  className?: string;
  scrollRange: [number, number];
  animationValues: {
    x: [number, number];
    y: [number, number];
    scale: [number, number];
  };
}

export const CurentaSvg = observer(function Component({
  ref,
  scrollRange,
  animationValues,
}: CurentaSvgProps) {
  const { scrollYProgress } = useScroll({
    target: ref,
  });

  const animation = useObservable(generateAnimationValues(animationValues, 0));

  useMotionValueEvent(scrollYProgress, 'change', (current) => {
    // Check if current is not undefined and is a number
    if (typeof current === 'number') {
      const [minScroll, maxScroll] = scrollRange;
      let condition =
        current > minScroll && current < maxScroll
          ? 'range'
          : current < minScroll
            ? 'min'
            : 'max';

      switch (condition) {
        case 'range':
          const percentage = calculatePercentage(scrollRange, current);
          const reversePercentage = 100 - percentage;
          const { x, y, scale } = animationValues;
          animation.set({
            x: percentageToValue(x, reversePercentage),
            y: percentageToValue(y, reversePercentage),
            scale: percentageToValue(scale, reversePercentage),
          });
          break;
        case 'min':
          animation.set(generateAnimationValues(animationValues, 0));
          break;
        case 'max':
          animation.set(generateAnimationValues(animationValues, 1));
          break;
      }
    }
  });

  return (
    <motion.svg
      xmlns='http://www.w3.org/2000/svg'
      viewBox='0 0 1000 217.08'
      id='Layer_1'
      data-name='Layer 1'
      animate={animation.get()}
      transition={{ bounce: false, duration: 0 }}
      className='fixed z-20 w-[50vw]'
    >
      <defs>
        <style>
          {
            '.cls-1 {fill: #0e0;} .cls-1, .cls-2 {stroke-width: 0px;} .cls-2 {fill: #006cd0;}'
          }
        </style>
      </defs>
      <g>
        <path
          className='cls-2'
          d='M388.72,162.58c8.19,0,15.44-2.21,21.74-6.3,6.3-4.1,11.03-9.77,13.86-17.01h13.86c-3.78,11.03-10.08,19.53-19.22,25.84-9.45,6.93-20.79,10.08-33.71,10.08-17.01,0-30.88-5.67-41.27-17.33-10.08-11.03-14.81-25.21-14.81-42.22s5.04-31.19,14.81-42.22c10.71-11.66,24.26-17.33,41.27-17.33,12.92,0,23.95,3.47,33.71,10.08,8.82,6.3,15.44,15.12,19.22,25.84h-13.86c-3.15-7.25-7.56-12.92-13.86-17.01-6.3-4.1-13.55-6.3-21.74-6.3s-15.12,1.26-20.79,3.47c-5.67,2.52-10.08,5.67-13.86,10.08-7.56,8.51-11.34,19.53-11.34,33.08s3.78,24.58,11.34,33.08c7.88,9.77,19.53,14.18,34.66,14.18h0Z'
        />
        <path
          className='cls-2'
          d='M518.85,174.23v-13.86c-3.15,4.1-6.93,7.88-11.66,10.71-4.73,2.84-9.77,4.41-15.75,4.41s-11.03-.95-15.12-2.52c-4.1-1.58-7.88-4.1-11.03-7.25-7.25-7.25-11.03-16.7-11.03-28.36v-51.04h13.23v50.73c0,8.19,2.21,14.49,6.93,19.22,4.73,4.73,10.4,7.25,17.64,7.25s13.55-2.52,18.9-7.25c5.04-5.04,7.56-11.34,7.56-19.22v-50.73h13.23v87.91h-12.92Z'
        />
        <path
          className='cls-2'
          d='M601.08,84.75v13.23h-1.58c-9.45,0-17.33,3.78-23.32,11.34-5.67,7.25-8.51,16.07-8.51,25.84v38.75h-13.23v-87.91h13.23v21.74c2.84-9.14,8.82-15.75,18.27-20.16,3.78-1.89,8.51-2.84,14.18-2.84h.95Z'
        />
        <path
          className='cls-2'
          d='M652.12,163.52c11.97,0,20.16-5.04,25.52-14.81h14.49c-3.15,7.88-7.88,14.49-14.49,19.22-6.62,5.04-15.12,7.25-25.52,7.25-13.23,0-23.95-4.41-32.45-13.23-8.19-8.51-12.29-19.22-12.29-32.14s3.78-23.63,11.66-32.14c8.19-8.82,18.9-13.23,31.82-13.23s23.95,4.41,31.82,13.23c7.56,8.51,11.66,19.22,11.66,32.14v5.36h-73.73c.95,8.19,4.1,14.81,9.77,20.16,5.99,5.67,13.23,8.19,21.74,8.19h0ZM651.18,96.73c-8.19,0-14.81,2.52-20.48,7.56-5.04,4.73-8.19,11.03-9.45,18.9h59.86c-1.26-7.88-4.41-13.86-9.45-18.9-5.67-5.04-12.29-7.56-20.48-7.56Z'
        />
        <path
          className='cls-2'
          d='M724.27,86.33v13.55c3.15-4.1,6.93-7.88,11.66-10.71,4.41-2.84,9.77-4.41,15.75-4.41s11.03.95,15.12,2.52c4.1,1.58,7.88,4.1,11.03,7.25,7.25,7.25,11.03,16.7,11.03,28.36v51.04h-13.23v-50.73c0-8.19-2.21-14.49-6.93-19.22-4.73-4.73-10.4-7.25-17.64-7.25s-13.55,2.52-18.9,7.25c-5.04,5.04-7.56,11.34-7.56,19.22v50.73h-13.23v-87.91l12.92.32h0Z'
        />
        <path
          className='cls-2'
          d='M817.85,174.23v-76.25h-17.96v-11.66h17.96v-31.51h13.23v31.51h20.16v11.66h-20.16v76.25h-13.23Z'
        />
        <path
          className='cls-2'
          d='M932.54,160.06c-6.93,10.4-17.64,15.44-31.51,15.44-12.6,0-23-4.41-30.88-13.23-7.88-8.82-11.66-19.53-11.66-32.14s3.78-23.63,11.66-32.14c7.88-8.82,18.59-13.23,31.82-13.23s23.32,5.04,30.56,15.75v-14.18h13.23v87.91h-13.55l.32-14.18h0ZM902.6,163.52c9.45,0,17.01-3.15,22.37-9.77,5.36-6.3,7.88-14.18,7.88-23.63s-2.52-17.33-7.88-23.63c-5.67-6.62-12.92-9.77-22.37-9.77s-17.01,3.15-22.69,9.77c-5.67,6.3-8.19,14.18-8.19,23.63s2.84,17.33,8.19,23.63c5.67,6.62,13.55,9.77,22.69,9.77Z'
        />
      </g>
      <path
        className='cls-1'
        d='M236.54,101.45l-33.71,33.71-52.93-52.93,33.71-33.71c6.93-6.93,16.38-11.03,26.47-11.03s19.53,3.78,26.47,11.03c6.93,7.25,11.03,16.38,11.03,26.47s-4.1,19.22-11.03,26.47Z'
      />
      <path
        className='cls-2'
        d='M127.84,22.06C113.35,7.56,94.13,0,74.91,0S36.47,7.25,21.98,22.06c-29.3,29.3-29.3,76.56,0,105.86l32.77,32.45c-1.26-5.99-1.89-11.97-1.89-17.96,0-10.71,1.89-21.42,5.67-31.19l-9.77-9.77c-14.49-14.49-14.49-38.44,0-52.93,6.93-6.93,16.38-11.03,26.47-11.03s19.53,3.78,26.47,11.03l4.1,4.1,26.47-26.47-4.41-4.1h0Z'
      />
      <path
        className='cls-2'
        d='M262.69,22.06C248.2,7.56,228.98,0,209.76,0s-38.12,7.25-52.93,22.06l-33.71,33.71-33.71,33.71c-29.3,29.3-29.3,76.56,0,105.55,14.49,14.49,33.71,22.06,52.93,22.06s38.44-7.25,52.93-22.06l33.71-33.71,33.71-33.71c29.3-28.99,29.3-76.25,0-105.55h0ZM236.54,101.45l-33.71,33.71-33.71,33.71c-6.93,6.93-16.38,11.03-26.47,11.03s-19.22-3.78-26.47-11.03c-6.93-6.93-11.03-16.38-11.03-26.47s3.78-19.53,11.03-26.47l33.71-33.71,33.71-33.71c6.93-6.93,16.38-11.03,26.47-11.03s19.53,3.78,26.47,11.03c6.93,6.93,11.03,16.38,11.03,26.47-.32,10.08-4.1,19.22-11.03,26.47h0Z'
      />
      <path
        className='cls-2'
        d='M981.23,83.58c-2.71,0-5.2-.47-7.49-1.4-2.29-.93-4.26-2.23-5.93-3.9-1.67-1.67-2.97-3.65-3.9-5.93-.93-2.29-1.4-4.78-1.4-7.49s.47-5.2,1.4-7.49c.93-2.28,2.23-4.27,3.9-5.96,1.67-1.69,3.65-3,5.93-3.93,2.29-.93,4.78-1.4,7.49-1.4s5.2.47,7.49,1.4c2.29.93,4.27,2.24,5.96,3.93,1.69,1.69,3,3.67,3.93,5.96.93,2.29,1.4,4.78,1.4,7.49s-.47,5.2-1.4,7.49c-.93,2.29-2.24,4.26-3.93,5.93-1.69,1.67-3.67,2.97-5.96,3.9-2.29.93-4.78,1.4-7.49,1.4ZM981.23,80.78c3.09,0,5.85-.68,8.28-2.06,2.43-1.37,4.33-3.25,5.72-5.64,1.39-2.39,2.08-5.13,2.08-8.23s-.7-5.84-2.08-8.25c-1.39-2.41-3.3-4.31-5.72-5.69-2.42-1.39-5.19-2.08-8.28-2.08s-5.91.69-8.33,2.08c-2.43,1.39-4.32,3.29-5.67,5.69-1.35,2.41-2.03,5.16-2.03,8.25s.68,5.85,2.03,8.25c1.35,2.41,3.24,4.29,5.67,5.64,2.43,1.35,5.2,2.03,8.33,2.03ZM974.13,73.7v-17.58h9.22c1.96,0,3.47.46,4.52,1.39,1.05.93,1.58,2.21,1.58,3.86,0,1.14-.32,2.15-.96,3.03-.64.88-1.5,1.55-2.58,2l4.1,7.3h-3.54l-3.54-6.66h-5.59v6.66h-3.2ZM977.33,64.4h5.76c.94,0,1.69-.26,2.24-.77.55-.51.83-1.21.83-2.09s-.27-1.56-.81-2.05c-.54-.48-1.29-.73-2.26-.73h-5.76v5.63Z'
      />
    </motion.svg>
  );
});
